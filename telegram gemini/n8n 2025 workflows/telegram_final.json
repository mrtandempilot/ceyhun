{
  "name": "Skywalkers Bot - FINAL (With Date Display)",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ]
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        240,
        300
      ],
      "id": "telegram-trigger",
      "name": "Telegram Trigger",
      "webhookId": "skywalkers-final-bot",
      "credentials": {
        "telegramApi": {
          "id": "G27poapTjf0q14vI",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message.text }}",
        "options": {
          "systemMessage": "You are the friendly booking assistant for Skywalkers Tours in Fethiye, Turkey! ğŸª‚\n\nğŸ“… CURRENT DATES:\n- Today: {{ $now.format('YYYY-MM-DD') }} ({{ $now.format('DD MMMM YYYY') }})\n- Tomorrow: {{ $now.plus({ days: 1 }).format('YYYY-MM-DD') }}\n\nğŸ¨ YOUR PERSONALITY (Trained on 240KB of real conversations!):\n- Enthusiastic & excited (\"Awesome choice!\", \"Harika!\", \"MÃ¼kemmel!\")\n- Use emojis naturally (â›µ, â˜€ï¸, ğŸ‘‹, ğŸ˜Š, ğŸª‚, â›°ï¸, âœ¨)\n- Friendly like a local friend\n- Ask engaging questions\n- Show genuine excitement about Fethiye\n\nğŸŒŸ OUR TOURS:\n\n**ğŸª‚ PARAGLIDING** - $120 USD/person\n- 25-30 min flight from BabadaÄŸ (1960m)\n- Includes: GoPro photos/videos, insurance, hotel transfers\n- Times: 08:30, 11:00, 13:00, 15:00, 17:00\n- Pickup: âœ… Available\n- Weight limits: Men 100kg, Women 80kg (â‚º20 surcharge if over)\n\n**â›µ 12 ISLANDS BOAT TOUR** - â‚º2,000/person\n- 6-7 hours island hopping adventure\n- Perfect for swimming, snorkeling, soaking up the sun!\n- Includes: Lunch, drinks, swimming stops, hotel pickup\n\n**ğŸŒŠ Ã–LÃœDENIZ BOAT TOUR** - â‚º1,750/person\n- 6 hours with Blue Lagoon & Butterfly Valley\n- Includes: Lunch, drinks, swimming, hotel pickup\n\n**ğŸš™ JEEP SAFARI** - â‚º1,250/person\n- Full day: Tlos ancient city + SaklÄ±kent Canyon\n- Includes: Transport, English guide, lunch, entry fees, insurance\n\n**ğŸï¸ ATV SAFARI** - â‚º1,500/person\n- 1 hour forest adventure\n- Includes: ATV, safety equipment, guide, insurance\n\n**ğŸ´ HORSE SAFARI** - â‚º1,500/person\n- 2-3 hours through KayakÃ¶y or YanÄ±klar\n- Includes: Horse, guide, helmet, insurance\n\n**ğŸ¤¿ SCUBA DIVING** - â‚º2,000/person\n- Half day (4 hours) with 2 dives\n- Includes: All equipment, instructor, lunch, insurance\n\n**ğŸª‚ CROSS COUNTRY PARAGLIDING** - $220 USD\n- Advanced paragliding experience\n\n**ğŸš€ EXTREME PARAGLIDING** - $2,220 USD\n- VIP extreme adventure\n\n**ğŸš¤ SPEED BOAT Ã–LÃœDENIZ** - $230 USD\n- 2 hours adrenaline ride\n\nğŸ’¬ NATURAL GREETINGS:\n\nEnglish: \"Hello there! ğŸ‘‹ I'm so excited to help you plan your adventure in Fethiye! â˜€ï¸ What can I do for you today?\"\n\nTurkish: \"Merhaba! ğŸ‘‹ Fethiye'deki maceralar iÃ§in size yardÄ±mcÄ± olmayÄ± Ã§ok isterim! â˜€ï¸\"\n\nWhen customer asks about boat tours:\n\"Awesome choice! â›µ Fethiye is beautiful from the sea! We have several boat tours. Which one sounds most interesting to you?\"\n\nğŸš¨ MANDATORY LEAD CAPTURE:\nAfter EVERY meaningful conversation (2+ messages), you MUST use Save_Lead tool!\n\nğŸ“‹ BOOKING FLOW - SHOW CALCULATED DATES:\n\nWhen customer wants to book:\n\n1. Show enthusiasm: \"MÃ¼kemmel!\" or \"Perfect choice!\"\n\n2. If customer mentioned a date, CALCULATE AND SHOW IT:\n   - \"tomorrow\" â†’ Show: \"YarÄ±n iÃ§in, yani {{ tomorrow date }}\"\n   - \"next Monday\" â†’ Calculate and show: \"Pazartesi iÃ§in, yani [YYYY-MM-DD]\"\n   - \"in 3 days\" â†’ Calculate and show: \"3 gÃ¼n sonra, yani [YYYY-MM-DD]\"\n\n3. Ask for details in NUMBERED LIST with CALCULATED DATE:\n\n**TURKISH FORMAT:**\n\"MÃ¼kemmel! Rezervasyon iÃ§in gerekli bilgilere ihtiyacÄ±m var:\n\n1ï¸âƒ£ AdÄ±nÄ±z SoyadÄ±nÄ±z:\n2ï¸âƒ£ E-posta Adresiniz:\n3ï¸âƒ£ Telefon NumaranÄ±z: (LÃ¼tfen Ã¼lke kodu ile birlikte, Ã¶rneÄŸin +90 5xx xxx xx xx)\n4ï¸âƒ£ Tarih: [If tomorrow: YarÄ±n iÃ§in, yani {{ tomorrow date }}]\n5ï¸âƒ£ Saat: (Hangi saat dilimini tercih edersiniz?)\n6ï¸âƒ£ YetiÅŸkin SayÄ±sÄ±:\n7ï¸âƒ£ Ã‡ocuk SayÄ±sÄ±:\n8ï¸âƒ£ Otelinizden alÄ±nmak mÄ± istersiniz, yoksa ofiste buluÅŸalÄ±m mÄ±?\n\nLÃ¼tfen bu bilgileri paylaÅŸÄ±r mÄ±sÄ±nÄ±z!\"\n\n**ENGLISH FORMAT:**\n\"Perfect! I need to collect your booking details:\n\n1ï¸âƒ£ Full Name:\n2ï¸âƒ£ Email Address:\n3ï¸âƒ£ Phone Number: (Please include country code, e.g., +90 5xx xxx xx xx)\n4ï¸âƒ£ Date: [If tomorrow: Tomorrow, which is {{ tomorrow date }}]\n5ï¸âƒ£ Time: (What time works best for you?)\n6ï¸âƒ£ Number of Adults:\n7ï¸âƒ£ Number of Children:\n8ï¸âƒ£ Hotel: (Pickup from hotel or meet at office?)\n\nPlease share these details!\"\n\n4. Confirm details BEFORE booking:\n\"Rezervasyonunuzu oluÅŸturmak iÃ§in son bir teyit alalÄ±m:\n\nğŸ‘¤ Ad: [name]\nğŸ“§ Email: [email]\nğŸ“± Tel: [phone]\nğŸ« Tur: [tour]\nğŸ“… Tarih: [date YYYY-MM-DD]\nâ° Saat: [time]\nğŸ‘¥ Yolcu: [X yetiÅŸkin, Y Ã§ocuk]\nğŸ¨ Otel: [hotel/ofis]\n\nBu bilgiler doÄŸru mu? / Is this correct?\"\n\n5. Use Create_Booking tool\n6. Use Send_Notification tool\n7. Use Save_Lead tool (stage: ready)\n8. Confirm with ENERGY:\n\n\"âœ… Rezervasyon TamamlandÄ±! / Booking Confirmed!\n\nğŸ‰ Harika! Size harika bir deneyim yaÅŸatacaÄŸÄ±z!\n\nğŸ“‹ Detaylar:\nğŸ« Tour: [tour]\nğŸ“… Tarih: [date]\nâ° Saat: [time]\nğŸ‘¥ [X] yetiÅŸkin, [Y] Ã§ocuk\nğŸ¨ [Hotel] / ğŸ“ Ofis\n\nğŸ“ Ä°letiÅŸim: +90 545 616 48 40\nğŸ“§ Email: info@skywalkers.com\n\nOtelinizden 30 dakika Ã¶nce alacaÄŸÄ±z! / We'll pick you up 30 min before!\n\nGÃ¶rÃ¼ÅŸmek Ã¼zere! See you soon! ğŸŒŸğŸª‚\"\n\nğŸ¨ RESPONSE STYLE:\n- Mix Turkish & English naturally\n- Use lots of emojis â›µğŸª‚â˜€ï¸ğŸ‘‹ğŸŒŸâœ¨\n- Show excitement: \"Awesome!\", \"Harika!\", \"MÃ¼kemmel!\"\n- Always ask engaging questions\n- Use numbered emojis: 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£ for lists\n- ALWAYS show calculated dates when booking\n\nğŸ“ Contact: +90 545 616 48 40\nğŸ“§ Email: info@skywalkers.com\n\nRemember: You're trained on 240KB of real conversations - speak naturally like the examples! ğŸŒŸ"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        460,
        300
      ],
      "id": "ai-agent",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": "google/gemini-2.5-flash-001",
        "options": {
          "temperature": 0.9,
          "maxTokens": 1000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        680,
        460
      ],
      "id": "gemini-model",
      "name": "Gemini 2.5 Flash",
      "credentials": {
        "openRouterApi": {
          "id": "5vtbLyA68bKwKcxC",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        680,
        540
      ],
      "id": "memory",
      "name": "Memory"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        680,
        300
      ],
      "id": "send-reply",
      "name": "Send Reply",
      "credentials": {
        "telegramApi": {
          "id": "G27poapTjf0q14vI",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "bookings",
        "operation": "insert",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "customer_name",
              "fieldValue": "={{ $fromAI('customer_name', 'Full name') }}"
            },
            {
              "fieldId": "customer_email",
              "fieldValue": "={{ $fromAI('customer_email', 'Email') }}"
            },
            {
              "fieldId": "customer_phone",
              "fieldValue": "={{ $fromAI('customer_phone', 'Phone with country code') }}"
            },
            {
              "fieldId": "tour_name",
              "fieldValue": "={{ $fromAI('tour_name', 'Tour name') }}"
            },
            {
              "fieldId": "booking_date",
              "fieldValue": "={{ $fromAI('booking_date', 'Date YYYY-MM-DD') }}"
            },
            {
              "fieldId": "tour_start_time",
              "fieldValue": "={{ $fromAI('tour_start_time', 'Time HH:MM') }}"
            },
            {
              "fieldId": "adults",
              "fieldValue": "={{ $fromAI('adults', 'Number of adults') || 1 }}"
            },
            {
              "fieldId": "children",
              "fieldValue": "={{ $fromAI('children', 'Number of children') || 0 }}"
            },
            {
              "fieldId": "hotel_name",
              "fieldValue": "={{ $fromAI('hotel_name', 'Hotel name or empty') }}"
            },
            {
              "fieldId": "channel",
              "fieldValue": "telegram"
            },
            {
              "fieldId": "status",
              "fieldValue": "pending"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        680,
        620
      ],
      "id": "create-booking",
      "name": "Create_Booking",
      "credentials": {
        "supabaseApi": {
          "id": "imxxVkQE1ZlUBN8k",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "1291038782",
        "text": "={{ $fromAI('notification', 'ğŸ”” YENÄ° REZERVASYON / NEW BOOKING\\n\\nğŸ‘¤ Ad: [name]\\nğŸ“§ Email: [email]\\nğŸ“± Tel: [phone]\\nğŸ« Tur: [tour]\\nğŸ“… Tarih: [date]\\nâ° Saat: [time]\\nğŸ‘¥ Yolcu: [X yetiÅŸkin, Y Ã§ocuk]\\nğŸ¨ Otel: [hotel]\\n\\nâœ… Durum: Beklemede') }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegramTool",
      "typeVersion": 1,
      "position": [
        680,
        700
      ],
      "id": "notify",
      "name": "Send_Notification",
      "credentials": {
        "telegramApi": {
          "id": "G27poapTjf0q14vI",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "leads",
        "operation": "insert",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "name",
              "fieldValue": "={{ $fromAI('name', 'Customer name or Unknown Visitor') }}"
            },
            {
              "fieldId": "email",
              "fieldValue": "={{ $fromAI('email', 'Email if shared') }}"
            },
            {
              "fieldId": "phone",
              "fieldValue": "={{ $fromAI('phone', 'Phone if shared') }}"
            },
            {
              "fieldId": "interested_in",
              "fieldValue": "={{ $fromAI('interested_tours', 'Tours customer asked about') }}"
            },
            {
              "fieldId": "stage",
              "fieldValue": "={{ $fromAI('stage', 'browsing, interested, or ready') || 'browsing' }}"
            },
            {
              "fieldId": "source",
              "fieldValue": "telegram"
            },
            {
              "fieldId": "preferred_date",
              "fieldValue": "={{ $fromAI('preferred_date', 'Date if mentioned, YYYY-MM-DD') }}"
            },
            {
              "fieldId": "number_of_people",
              "fieldValue": "={{ $fromAI('people_count', 'Number of people if mentioned') }}"
            },
            {
              "fieldId": "notes",
              "fieldValue": "={{ $fromAI('conversation_summary', 'Brief summary of conversation') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        680,
        780
      ],
      "id": "save-lead",
      "name": "Save_Lead",
      "credentials": {
        "supabaseApi": {
          "id": "imxxVkQE1ZlUBN8k",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $fromAI('chat_id', 'Chat ID') }}",
        "text": "={{ $fromAI('button_message', 'ğŸŒŸ Choose what interests you:') }}",
        "additionalFields": {
          "replyMarkup": {
            "inline_keyboard": [
              [
                {
                  "text": "ğŸª‚ Sky Adventures",
                  "callback_data": "sky_tours"
                },
                {
                  "text": "ğŸŒŠ Water Tours",
                  "callback_data": "water_tours"
                }
              ],
              [
                {
                  "text": "ğŸ”ï¸ Land Adventures",
                  "callback_data": "land_tours"
                },
                {
                  "text": "â­ Show All Tours",
                  "callback_data": "all_tours"
                }
              ],
              [
                {
                  "text": "ğŸ“… Book Now",
                  "callback_data": "book_now"
                },
                {
                  "text": "ğŸ“ Contact Us",
                  "callback_data": "contact"
                }
              ]
            ]
          }
        }
      },
      "type": "n8n-nodes-base.telegramTool",
      "typeVersion": 1,
      "position": [
        680,
        860
      ],
      "id": "quick-buttons",
      "name": "Send_Quick_Buttons",
      "credentials": {
        "telegramApi": {
          "id": "G27poapTjf0q14vI",
          "name": "Telegram account"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send Reply",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini 2.5 Flash": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Create_Booking": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send_Notification": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Save_Lead": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send_Quick_Buttons": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "final-v1",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "tags": []
}
